# Architecture Diagrams

## Current voice_Access Implementation (TTS Only)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         App.tsx                              â”‚
â”‚                            â”‚                                 â”‚
â”‚                            â”œâ”€ initTTS()                      â”‚
â”‚                            â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   useResourceStore                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  State:                                               â”‚  â”‚
â”‚  â”‚  - tts: KokoroTTS | null                             â”‚  â”‚
â”‚  â”‚  - isTTSInitializing: boolean                        â”‚  â”‚
â”‚  â”‚  - ttsReady: boolean                                 â”‚  â”‚
â”‚  â”‚  - ttsProgress: number (0-100)                       â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Methods:                                             â”‚  â”‚
â”‚  â”‚  - initTTS(): Promise<void>                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KokoroTTS Service                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Private:                                             â”‚  â”‚
â”‚  â”‚  - synthesizer: NeuralKokoro                         â”‚  â”‚
â”‚  â”‚  - queue: Promise<any>                               â”‚  â”‚
â”‚  â”‚  - VALID_VOICES: string[] (54 voices)               â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Public Methods:                                      â”‚  â”‚
â”‚  â”‚  - initialize(onProgress?)                           â”‚  â”‚
â”‚  â”‚  - speak(text, voice): Promise<{audio, rate}>       â”‚  â”‚
â”‚  â”‚  - isReady(): boolean                                â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Features:                                            â”‚  â”‚
â”‚  â”‚  âœ“ WebGPU with WASM fallback                        â”‚  â”‚
â”‚  â”‚  âœ“ fp32 precision                                    â”‚  â”‚
â”‚  â”‚  âœ“ Queue management                                  â”‚  â”‚
â”‚  â”‚  âœ“ Progress tracking                                 â”‚  â”‚
â”‚  â”‚  âœ“ Language detection                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       useTTS Hook                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Returns:                                             â”‚  â”‚
â”‚  â”‚  - speak(text, voice): Promise<void>                 â”‚  â”‚
â”‚  â”‚  - stop(): void                                       â”‚  â”‚
â”‚  â”‚  - isSpeaking: boolean                               â”‚  â”‚
â”‚  â”‚  - ready: boolean                                     â”‚  â”‚
â”‚  â”‚  - progress: number                                   â”‚  â”‚
â”‚  â”‚  - isInitializing: boolean                           â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Handles:                                             â”‚  â”‚
â”‚  â”‚  - Audio playback via Web Audio API                  â”‚  â”‚
â”‚  â”‚  - AudioContext management                           â”‚  â”‚
â”‚  â”‚  - Speaking state                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Web Audio API  â”‚
                    â”‚   (Browser)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
                        ğŸ”Š Speakers
```

## Midnight-Pad Full Voice System

```
                        ğŸ‘¤ User speaks
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Microphone    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              VoiceRecognitionService (Orchestrator)          â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Components:                                           â”‚ â”‚
â”‚  â”‚  - WakeWordDetector                                    â”‚ â”‚
â”‚  â”‚  - SpeechToTextProvider (Web Speech / Ollama)        â”‚ â”‚
â”‚  â”‚  - CommandParser                                       â”‚ â”‚
â”‚  â”‚  - VoiceCommandExecutor                               â”‚ â”‚
â”‚  â”‚  - VoiceStateManager                                  â”‚ â”‚
â”‚  â”‚  - VoiceProcessor                                      â”‚ â”‚
â”‚  â”‚  - VoiceFeedbackManager                               â”‚ â”‚
â”‚  â”‚  - VoiceResponder                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WakeWord     â”‚  â”‚  Speech to   â”‚  â”‚   Command    â”‚
â”‚  Detector    â”‚  â”‚     Text     â”‚  â”‚    Parser    â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ Listens for: â”‚  â”‚ Providers:   â”‚  â”‚ Parses:      â”‚
â”‚ - "Jarvis"   â”‚  â”‚ - Web Speech â”‚  â”‚ - launch-app â”‚
â”‚ - "Computer" â”‚  â”‚ - Ollama     â”‚  â”‚ - volume-set â”‚
â”‚ - "Hey..."   â”‚  â”‚              â”‚  â”‚ - AI queries â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ VoiceProcessor   â”‚
              â”‚                  â”‚
              â”‚ Handles:         â”‚
              â”‚ - Wake word mode â”‚
              â”‚ - Command mode   â”‚
              â”‚ - Dictation mode â”‚
              â”‚ - AI fallback    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Command Executor â”‚
              â”‚                  â”‚
              â”‚ Executes:        â”‚
              â”‚ - App launches   â”‚
              â”‚ - System cmds    â”‚
              â”‚ - AI queries     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Feedback Manager â”‚
              â”‚                  â”‚
              â”‚ Generates:       â”‚
              â”‚ - Success msgs   â”‚
              â”‚ - Error msgs     â”‚
              â”‚ - Confirmations  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     VoiceResponder                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Features:                                             â”‚ â”‚
â”‚  â”‚  - Text chunking for long responses                   â”‚ â”‚
â”‚  â”‚  - Multiple TTS providers (Kokoro, System, Piper)    â”‚ â”‚
â”‚  â”‚  - Audio capture for recording                        â”‚ â”‚
â”‚  â”‚  - Volume control                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      KokoroTTS Service                       â”‚
â”‚  (Same as voice_Access implementation)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AudioPlaybackService                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Features:                                             â”‚ â”‚
â”‚  â”‚  - Gapless audio playback                             â”‚ â”‚
â”‚  â”‚  - Sample rate conversion (resampling)                â”‚ â”‚
â”‚  â”‚  - Precise scheduling                                  â”‚ â”‚
â”‚  â”‚  - Volume control with gain nodes                     â”‚ â”‚
â”‚  â”‚  - Multiple source management                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Web Audio API  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
                      ğŸ”Š Speakers
                           â”‚
                           â–¼
                      ğŸ‘¤ User hears
```

## Voice State Flow (Midnight-Pad)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    IDLE     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                           â”‚
       â”‚                                  â”‚
       â”‚ start(mode='auto')               â”‚
       â”‚ alwaysListening=true             â”‚
       â–¼                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚ WAKE-WORD   â”‚                           â”‚
â”‚   MODE      â”‚                           â”‚
â”‚             â”‚                           â”‚
â”‚ Listening   â”‚                           â”‚
â”‚ for wake    â”‚                           â”‚
â”‚ words...    â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                           â”‚
       â”‚                                  â”‚
       â”‚ Wake word detected               â”‚
       â”‚ ("Jarvis", "Computer")           â”‚
       â–¼                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  COMMAND    â”‚                           â”‚
â”‚    MODE     â”‚                           â”‚
â”‚             â”‚                           â”‚
â”‚ Processing  â”‚                           â”‚
â”‚ voice       â”‚                           â”‚
â”‚ command...  â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                           â”‚
       â”‚                                  â”‚
       â”œâ”€ Command executed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚  (if alwaysListening=true)       â”‚
       â”‚                                  â”‚
       â”œâ”€ Command executed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚  (if alwaysListening=false)      â”‚
       â”‚                                  â”‚
       â””â”€ Error/Timeout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Text to Speech

```
User Component
     â”‚
     â”‚ speak("Hello", "af_heart")
     â–¼
  useTTS Hook
     â”‚
     â”‚ tts.speak(text, voice)
     â–¼
KokoroTTS Service
     â”‚
     â”‚ Queue management
     â”œâ”€ Check if initialized
     â”œâ”€ Get language code from voice
     â”‚
     â”‚ synthesizer.generate(text, {voice, language})
     â–¼
Neural Kokoro (kokoro-js)
     â”‚
     â”œâ”€ Try WebGPU (fp32)
     â”‚  â””â”€ Success â†’ Fast synthesis
     â”‚
     â””â”€ Fallback to WASM (fp32)
        â””â”€ Success â†’ Slower synthesis
     â”‚
     â”‚ Returns: { audio: Float32Array, sampling_rate: 24000 }
     â–¼
  useTTS Hook
     â”‚
     â”‚ Create AudioContext
     â”‚ Create AudioBuffer
     â”‚ Set audio data
     â”‚ Create BufferSource
     â”‚ Connect to destination
     â”‚ Start playback
     â–¼
Web Audio API
     â”‚
     â–¼
ğŸ”Š Speakers
```

## Component Hierarchy

```
voice_Access (Current)
â”œâ”€â”€ App.tsx
â”‚   â””â”€â”€ useEffect â†’ initTTS()
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ useResourceStore.ts
â”‚       â””â”€â”€ KokoroTTS instance
â”œâ”€â”€ services/
â”‚   â””â”€â”€ KokoroTTS.ts
â”‚       â””â”€â”€ Neural Kokoro wrapper
â””â”€â”€ hooks/
    â””â”€â”€ useTTS.ts
        â””â”€â”€ React hook for TTS

Midnight-Pad (Full System)
â”œâ”€â”€ App.tsx
â”‚   â””â”€â”€ useVoiceCommands()
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useVoiceCommands.ts
â”‚       â””â”€â”€ voiceService.start()
â”œâ”€â”€ services/voice/
â”‚   â”œâ”€â”€ VoiceRecognitionService.ts (Orchestrator)
â”‚   â”œâ”€â”€ WakeWordDetector.ts
â”‚   â”œâ”€â”€ SpeechToTextProvider.ts
â”‚   â”œâ”€â”€ CommandParser.ts
â”‚   â”œâ”€â”€ VoiceCommandExecutor.ts
â”‚   â”œâ”€â”€ VoiceStateManager.ts
â”‚   â”œâ”€â”€ VoiceProcessor.ts
â”‚   â”œâ”€â”€ VoiceFeedbackManager.ts
â”‚   â”œâ”€â”€ VoiceResponder.ts
â”‚   â”‚   â””â”€â”€ Uses KokoroTTS
â”‚   â”œâ”€â”€ KokoroTTS.ts
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ AudioPlaybackService.ts
â”‚       â”œâ”€â”€ LocalSpeechService.ts
â”‚       â”œâ”€â”€ TextProcessor.ts
â”‚       â””â”€â”€ AudioWavConverter.ts
â””â”€â”€ stores/
    â””â”€â”€ useUIStore.ts
```

## Voice Modes (Midnight-Pad)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Voice Modes                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  1. IDLE                                                  â”‚
â”‚     - Not listening                                       â”‚
â”‚     - No audio processing                                 â”‚
â”‚                                                           â”‚
â”‚  2. WAKE-WORD                                            â”‚
â”‚     - Listening for wake words                           â”‚
â”‚     - Low CPU usage                                       â”‚
â”‚     - Triggers on: "Jarvis", "Computer", "Hey Computer" â”‚
â”‚                                                           â”‚
â”‚  3. COMMAND                                              â”‚
â”‚     - Processing voice command                           â”‚
â”‚     - High CPU usage                                      â”‚
â”‚     - Timeout: 5 seconds of silence                      â”‚
â”‚                                                           â”‚
â”‚  4. DICTATION                                            â”‚
â”‚     - Continuous text input                              â”‚
â”‚     - No command parsing                                  â”‚
â”‚     - Manual stop required                               â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## TTS Provider Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Provider   â”‚   Quality    â”‚    Speed     â”‚   Offline    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚              â”‚              â”‚              â”‚
â”‚  Kokoro     â”‚  â˜…â˜…â˜…â˜…â˜…       â”‚  â˜…â˜…â˜…â˜…â˜†       â”‚  âœ“ Yes       â”‚
â”‚  (Neural)   â”‚  Excellent   â”‚  Fast        â”‚  (cached)    â”‚
â”‚             â”‚  fp32        â”‚  WebGPU      â”‚              â”‚
â”‚             â”‚              â”‚              â”‚              â”‚
â”‚  System     â”‚  â˜…â˜…â˜…â˜†â˜†       â”‚  â˜…â˜…â˜…â˜…â˜…       â”‚  âœ“ Yes       â”‚
â”‚  Default    â”‚  Good        â”‚  Instant     â”‚  (native)    â”‚
â”‚             â”‚  Browser TTS â”‚  Native      â”‚              â”‚
â”‚             â”‚              â”‚              â”‚              â”‚
â”‚  Piper      â”‚  â˜…â˜…â˜…â˜…â˜†       â”‚  â˜…â˜…â˜…â˜†â˜†       â”‚  âœ“ Yes       â”‚
â”‚  (Backend)  â”‚  Very Good   â”‚  Medium      â”‚  (local)     â”‚
â”‚             â”‚  Neural      â”‚  CPU         â”‚              â”‚
â”‚             â”‚              â”‚              â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Legend

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Symbols Used in Diagrams                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”‚  â–¼  â†’  â†  â†‘  â†“  â”€  â”  â””  â”˜  â”Œ                      â”‚
â”‚  Flow direction arrows                                   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚   â”‚  â”‚         â”‚  Boxes represent components         â”‚
â”‚  â””â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                                                          â”‚
â”‚  âœ“  âœ…  Completed / Available                           â”‚
â”‚  âŒ  âœ—  Not available / Failed                          â”‚
â”‚  â˜…  Rating indicator                                     â”‚
â”‚  ğŸ”Š  Audio output                                        â”‚
â”‚  ğŸ‘¤  User interaction                                    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
